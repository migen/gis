<?php
class Acl extends Model{

public function __construct(){
	parent::__construct();
}
public function test(){	echo "acl model test ";}
public function searchRows($params){		$params = rally('stripslashes',$params);	$conditions='';		if (!empty($params['role'])){ $conditions .= " AND t.role_id = '".$params['role']."'"; }						if (!empty($params['wurl'])){ $conditions .= " AND a.wurl LIKE '%".$params['wurl']."%'"; }							return $conditions; 	}public function grid($page){	/* conditions for advancedSearch */	$_SESSION['get'] = $_GET;		$_SESSION['ascending'] = isset($_GET['order'])? $_GET['order'] : 'ASC';	$condition = $this->searchRows($_SESSION['get']);			/* sort */	$sort = isset($_GET['sort'])? $_GET['sort'] : 'r.name ';	$order = $_SESSION['ascending'];			/* PAGINATION */	$page     = isset($page) ? $page : 1;									/* 1 of 3 */	$numrows  = isset($_GET['numrows'])? $_GET['numrows'] : 10;	$_SESSION['numrows'] = isset($numrows)? $numrows : 100;	$perPage  = ($_SESSION['numrows'] < 100)? $_SESSION['numrows']: '100';	/* 2 of 3 */	$offset   = ($page - 1) * $perPage;										/* 3 of 3 */	$dbg = PDBG;		$q = "		SELECT 			a.*,r.*,t.*,t.name AS title,r.name AS role,a.id AS id				FROM {$dbo}.`acl` AS a			LEFT JOIN {$dbo}.`00_titles` AS t ON a.title_id = t.id			LEFT JOIN {$dbo}.`00_roles` AS r ON t.role_id = r.id		WHERE 1=1					";		$q .= "  $condition  ";		$q .= " ORDER by $sort $order ";			/* pageNav */	$totalCount = $this->countAll($q);			if(!$totalCount){return false;}	$pagination = new Pagination($page,$perPage,$totalCount);		$data['pages'] = $pagination->pageNav('acl','index');		$data['num_pages']	= count($data['pages']);		$q .= " LIMIT $perPage OFFSET {$offset} ";				// echo "<br />q: $q <br />";							$_SESSION['q'] = $q;		$sth = $this->db->querysoc($q);			$data['rows'] =  $sth->fetchAll();					return $data;  }	/* fxn */public function read($id){$q = "	SELECT a.*,t.*,t.name AS title,a.id AS id	FROM {$dbo}.`acl` AS a 		LEFT JOIN {$dbo}.`00_titles` AS t ON a.title_id = t.id	WHERE a.id = '$id' LIMIT 1;";$sth = $this->db->querysoc($q);$row = $sth->fetch();return $row;}	/* fxn */public function acl($cond){$dbg=PDBG;	$q = " SELECT a.*,m.name AS module,r.name AS role			FROM {$dbg}.acl AS a				INNER JOIN {$dbo}.modules AS m ON m.id = a.module_id				INNER JOIN {$dbo}.`00_roles`  AS r ON r.id = a.role_id			$cond ";	$sth = $this->db->querysoc($q);	return $sth->fetchAll();}	/* fxn */public function selectsAcl(){	$q = " SELECT id,name FROM {$dbo}.modules ";	$sth = $this->db->querysoc($q);	$data['modules'] = $sth->fetchAll();	$q = " SELECT id,name FROM {$dbo}.`00_roles` ";	$sth = $this->db->querysoc($q);	$data['roles'] = $sth->fetchAll();	return $data;}	/* fxn */
}  /* Acl */