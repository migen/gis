<?php
class Attdlog extends Model{

public function __construct(){
	parent::__construct();
}
public function getAttendanceIdFirst($date,$attd){$q = " SELECT id FROM $attd WHERE `date` = '$date' ORDER BY id; ";$sth = $this->db->querysoc($q);$row = $sth->fetch();return $row['id'];}	/* fxn */public function getAttendanceLog($attid,$attd){$dbo=PDBO;$q = " SELECT att.*,c.name FROM $attd AS att INNER JOIN {$dbo}.`00_contacts` AS c ON c.id = att.contact_idWHERE att.`id` = '$attid' LIMIT 1; ";$sth = $this->db->querysoc($q);$row = $sth->fetch();return $row;}	/* fxn */public function person($cid,$fields=NULL,$dbg=PDBG){	$dbo=PDBO;	$q = " SELECT 			c.id AS cid,c.name AS person,			p.first_name AS fname,p.middle_name AS mname,p.last_name AS lname,			p.*,c.*						$fields		FROM {$dbo}.`00_contacts` AS c 			LEFT JOIN {$dbo}.`00_profiles` AS p ON p.contact_id 	 = c.id		WHERE c.id = $cid LIMIT 1; ";						$sth = $this->db->querysoc($q);	return $sth->fetch();	}	/* fxn */public function contactAttendance($dbg,$sy,$ucid,$fields=""){$dbo=PDBO;$q = "	SELECT c.*,ats.*,c.id AS ucid,c.name AS contact,sum.crid AS crid 	FROM {$dbo}.`00_contacts` AS c		LEFT JOIN {$dbg}.`05_attendance_schemas` AS ats ON ats.id = c.attschema_id		LEFT JOIN {$dbg}.`05_summaries` AS sum ON sum.scid = c.id	WHERE 	c.id = $ucid LIMIT 1; ";$sth = $this->db->querysoc($q);return $sth->fetch();}	/* fxn */public function sessionizeRoleContacts($dbg,$urid){$dbo=PDBO;$_SESSION['urid']	= $urid;$q = "SELECT 		c.id AS ucid,c.code,c.name AS contact	FROM {$dbo}.`00_contacts` AS c 	WHERE c.`role_id` = '$urid'		AND c.`is_active` = 1; ";$sth 	  = $this->db->querysoc($q);$contacts = $sth->fetchAll();$q = " SELECT 		c.id AS ucid,c.code,c.name AS contact	FROM {$dbo}.`00_contacts` AS c 		LEFT JOIN {$dbo}.`00_profiles` AS p ON p.`contact_id` = c.id	WHERE c.`role_id` = '$urid'		AND c.`is_male`   = 1		AND c.`is_active` = 1; ";$sth 	= $this->db->querysoc($q);$boys 	= $sth->fetchAll();$q = "	SELECT 		c.id AS ucid,c.code,c.name AS contact	FROM {$dbo}.`00_contacts` AS c 		LEFT JOIN {$dbo}.`00_profiles` AS p ON p.`contact_id` = c.id	WHERE c.`role_id` = '$urid'		AND c.`is_male`   <> '1' 		AND c.`is_active` = 1; ";$sth 	= $this->db->querysoc($q);$girls 	= $sth->fetchAll();$_SESSION['contacts'] 	= $contacts;$_SESSION['boys'] 		= $boys;$_SESSION['girls'] 		= $girls;}	/* fxn */

}  /* Attdlog */